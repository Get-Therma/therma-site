#!/usr/bin/env node

/**
 * Test Welcome Email Template
 * 
 * This script sends a test of the actual welcome email template
 */

// Load environment variables from .env.local
require('dotenv').config({ path: '.env.local' });

const { Resend } = require('resend');
const React = require('react');

// Import the email template (we'll use the compiled version)
const { ThankYouEmailTemplate } = require('../lib/email-templates.tsx');

async function testWelcomeEmail() {
  console.log('ğŸ“§ Testing Welcome Email Template...\n');

  // Get email from command line argument or prompt
  let testEmail = process.argv[2];

  if (!testEmail) {
    // Prompt for email address if not provided
    const readline = require('readline').createInterface({
      input: process.stdin,
      output: process.stdout
    });

    await new Promise((resolve) => {
      readline.question('Enter your email address to receive the test: ', (email) => {
        testEmail = email;
        readline.close();
        resolve();
      });
    });
  }

  // Validate email
  if (!testEmail || !testEmail.includes('@')) {
    console.error('âŒ Invalid email address');
    return;
  }

  // Check environment variables
  const apiKey = process.env.RESEND_API_KEY;

  if (!apiKey) {
    console.error('âŒ Missing RESEND_API_KEY environment variable');
    console.error('\nğŸ“ Please set up your .env.local file with:');
    console.error('   RESEND_API_KEY="your_resend_api_key"');
    return;
  }

  console.log('\nâœ… RESEND_API_KEY found');
  console.log(`ğŸ“¤ Sending welcome email to: ${testEmail}\n`);

  try {
    const resend = new Resend(apiKey);

    // Create the React component
    const emailComponent = React.createElement(ThankYouEmailTemplate, { email: testEmail });

    // Use Resend's react prop for React components
    const emailResult = await resend.emails.send({
      from: 'Therma <hello@therma.one>',
      to: [testEmail],
      subject: 'Welcome to Therma! ğŸŒ¿',
      react: emailComponent
    });

    console.log('âœ… Welcome email sent successfully!');
    console.log('ğŸ“Š Email ID:', emailResult.data?.id);
    console.log('\nğŸ‰ Check your inbox to see the new welcome email!');
    console.log('   (Check spam folder if you don\'t see it)\n');

  } catch (error) {
    console.error('âŒ Error sending email:', error.message);
    console.error('\nğŸ” Troubleshooting:');
    console.error('   1. Verify your API key is correct');
    console.error('   2. Check that therma.one domain is verified in Resend');
    console.error('   3. Try using a different "from" domain if available');
    console.error('\nğŸ“‹ Full error:', error);
  }
}

// Run the test
testWelcomeEmail().catch(console.error);


